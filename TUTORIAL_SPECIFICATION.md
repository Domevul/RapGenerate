# チュートリアル・UI支援仕様 v1.0

## 設計方針

### コアコンセプト
- **段階的学習**: 機能を少しずつ解放
- **実践重視**: 説明よりも体験
- **常時支援**: チュートリアル後もヒント表示継続

### 基本思想
- プレイヤーは「やりながら学ぶ」
- 長い説明文は避ける
- 視覚的なヒント・アイコンを多用
- 上級者はヒントをOFFにできる

---

## チュートリアルフロー(3段階)

### レベル1: 基礎(コンボ構築 + リズム)

**学習目標:**
- コロケーションの選び方
- タップのタイミング
- スコアの見方

**制限:**
- 戦略選択なし(自動でB「切り返す」選択)
- デッキ構築なし(プリセットデッキ使用)
- 敵1ターンのみ(最短クリア)

**フロー:**
```
[モーダル表示]
「ラップバトルに挑戦しよう!
 相手のラップを聞いて、カードで返すんだ」
[次へ]

↓

[相手ターン] (8秒)
相手「お前のスキルまだまだだ」
表示: 💬攻撃的 🎵ライミングB

[モーダル表示]
「相手が攻めてきた!
 さあ、4枚のカードを選んで返そう!」
[次へ]

↓

[コンボ構築] (時間制限なし)
※チュートリアル中は時間無制限

ステップ1: 導入選択
┌───────────────┐
│ 💡 まず最初の   │
│   掴みを選ぼう   │
└───────────────┘

3択表示(1つに光るエフェクト)
[はいはい] ← ⭐おすすめ!

選択後:
[モーダル表示]
「いいね! 次はメインパートだ」

ステップ2: 中継ぎ1枚目
┌───────────────┐
│ 💡 相手への返しを │
│   選ぼう        │
└───────────────┘

3択表示(1つに光るエフェクト)
[お前のスキルまだまだだ] ← ⭐おすすめ!

ステップ3: 中継ぎ2枚目
┌───────────────┐
│ 💡 もう一押し!   │
└───────────────┘

3択表示
[それじゃおれには敵わん]

ステップ4: 締め
┌───────────────┐
│ 💡 最後に締めよう │
└───────────────┘

3択表示(1つに光るエフェクト)
[お疲れ] ← ⭐おすすめ!

↓

[モーダル表示]
「カードが決まった!
 リズムに合わせてタップしよう!」
[スタート]

↓

[攻撃フェーズ] (8秒)

♪ドンドン♪
→ "はいはい" (自動再生)

♪ドン♪
[タップターゲット表示]
┌─────────┐
│   ya    │
│    ↓    │
│ [タップ!] │ ← 光るエフェクト
└─────────┘

プレイヤータップ → Perfect!

(以下、4回のフィラータップ)

↓

[結果画面]
========= 結果 =========
リズム評価: 80点
ライミング評価: 75点
タイプ評価: 85点
-----------------------
総合スコア: 82点

[モーダル表示]
「よくできた! 82点!
 次は戦略選択を学ぼう」
[レベル2へ]
```

**ポイント:**
- 時間制限なし(焦らせない)
- おすすめカードに光るエフェクト
- 各ステップで短いヒント表示
- 1ターンで完結(すぐ終わる)

---

### レベル2: 戦略選択 + ライミングチェーン

**学習目標:**
- 相手のヒントを読む
- 戦略を選ぶ意味
- ライミングチェーンの概念

**追加要素:**
- 戦略選択解放
- ライミング表示・チェーンヒント
- 2ターン制に

**フロー:**
```
[モーダル表示]
「今度は戦略を自分で選ぼう!
 相手の「雰囲気」と「ライミング」をチェック!」
[次へ]

↓

[相手ターン1] (8秒)
相手「綺麗ごとで耳が痛い」
表示: 💬攻撃的 🎵ライミングA

↓

[戦略選択] (時間制限あり: 3秒)
┌───────────────────┐
│ 💡 相手が攻撃的!    │
│   「切り返す」が有効! │
└───────────────────┘

┌──────────────┐
│ A: 韻で攻める    │
└──────────────┘
┌──────────────┐
│ B: 切り返す ⭐推奨│ ← 光るエフェクト
└──────────────┘
┌──────────────┐
│ C: 自分のペース  │
└──────────────┘

↓

[コンボ構築] (時間制限あり: 10秒)
※通常より少し長め

ステップ1: 導入
[教えてやる] 選択

ステップ2: 中継ぎ1枚目
┌───────────────────┐
│ お前こそ痛い #A      │
│ #カウンター          │
│ 🎯 タイプ相性良し!    │ ← NEW
└───────────────────┘
選択

ステップ3: 中継ぎ2枚目
┌───────────────────┐
│ そんなの関係ない #A   │
│ #カウンター          │
│ 🔗 2チェーン達成!     │ ← NEW
│    ボーナス x1.5倍   │
└───────────────────┘
選択

[ミニモーダル表示]
「同じ韻(A)が続くとチェーン!
 ボーナスがもらえるぞ!」
[OK]

ステップ4: 締め
[負けるはずがない #A] 選択

[ミニモーダル表示]
「締めでも韻Aを選んだ!
 これで3チェーン達成だ!」
[OK]

↓

[攻撃フェーズ] (8秒)
(通常プレイ)

↓

[結果画面]
========= 結果 =========
リズム評価: 75点
ライミング評価: 95点 ← 3チェーン!
タイプ評価: 90点 ← 相性ボーナス!
-----------------------
総合スコア: 89点

[モーダル表示]
「素晴らしい! 89点!
 ライミングチェーンとタイプ相性で
 高得点を獲得したぞ!」
[次へ]

↓

[相手ターン2] (8秒)
相手「ここで抜く刀」
表示: 💬自信満々 🎵ライミングB

↓

[戦略選択] (3秒)
┌───────────────────┐
│ 💡 相手が自慢している! │
│   攻撃で返そう!       │
└───────────────────┘

┌──────────────┐
│ A: 韻で攻める    │
└──────────────┘
┌──────────────┐
│ B: 切り返す ⭐推奨│
└──────────────┘
┌──────────────┐
│ C: 自分のペース  │
└──────────────┘

プレイヤーがB選択

↓

[コンボ構築] (10秒)
(通常フロー、ヒント表示あり)

↓

[攻撃フェーズ] (8秒)

↓

[結果画面]
ターン2: 85点

↓

[最終結果]
========= 最終結果 =========
ターン1: 89点
ターン2: 85点
-----------------------
合計: 174点

あなたの勝利!

[モーダル表示]
「完璧だ!
 次はデッキを自分で組んでみよう!」
[レベル3へ]
```

**ポイント:**
- 戦略選択に推奨表示
- ライミングチェーンを実際に体験
- タイプ相性も実感
- 2ターンで戦略の使い分けを学ぶ
- 時間制限はやや長め(10秒)

---

### レベル3: デッキ構築 + 完全版

**学習目標:**
- デッキの組み方
- 戦略に合わせたカード選択
- すべての機能の理解

**追加要素:**
- デッキ構築画面解放
- 全機能開放
- 通常の時間制限(8秒)

**フロー:**
```
[モーダル表示]
「最後は自分だけのデッキを作ろう!
 戦略ごとにカードを選ぶんだ」
[デッキ構築へ]

↓

[デッキ構築画面]

┌─────────────────────┐
│ 💡 デッキ構築のコツ   │
├─────────────────────┤
│ ・戦略Aには同じ韻を多く│
│ ・戦略Bにはカウンター系│
│ ・戦略Cには自慢・夢中系│
│                     │
│ まずは導入から選ぼう!  │
└─────────────────────┘

【導入デッキ】 6個から3個選択
(初期は3個が光るエフェクト)

□ わかるか？
☑ 聞いてくれ ← 推奨
☑ 教えてやる ← 推奨
□ はいはい
□ 何言ってるかわかんねえ
☑ 知らねえ ← 推奨

[次へ]

↓

┌─────────────────────┐
│ 💡 戦略A「韻で攻める」 │
│                     │
│ 同じライミングを多めに │
│ 選ぶとチェーンしやすい! │
└─────────────────────┘

【戦略A: 韻で攻める】 12個から6個選択

ライミングA (5枚)
(初期は全部選択済み)
☑ じいちゃんの銀歯みたい
☑ 綺麗ごとで耳が痛い
☑ そんなの関係ない
☑ まだまだ言葉がいい足りない
☑ 君はここで敗退

ライミングB (3枚)
(初期は1枚選択済み)
☑ あがってく心と体
□ 陸に上がった魚
□ おれは日本の宝

(以下同様に戦略B、C、締めを選択)

[次へ]

↓

┌─────────────────────┐
│ デッキ完成!          │
│                     │
│ ・導入: 3枚          │
│ ・戦略A: 6枚         │
│ ・戦略B: 6枚         │
│ ・戦略C: 6枚         │
│ ・締め: 3枚          │
│                     │
│ これで準備OK!        │
└─────────────────────┘

[バトル開始]

↓

[通常バトル] (2ターン)
- 戦略選択あり
- コンボ構築(8秒)
- すべてのUI支援機能有効

↓

[最終結果]
(勝敗判定)

↓

[モーダル表示]
「チュートリアル完了!
 これで全ての機能が使えるようになった!
 
 本番のバトルに挑戦しよう!」
[メインメニューへ]
```

**ポイント:**
- デッキ構築は推奨選択あり(迷わない)
- 各戦略のコツを簡潔に説明
- 実戦と同じ時間制限(8秒)
- すべての機能が使える状態

---

## チュートリアルの進行管理

### 状態管理

```javascript
const tutorialState = {
  currentLevel: 1, // 1-3
  completed: [], // 完了済みレベル [1, 2] など
  skipped: false, // スキップしたか
  
  restrictions: {
    level1: {
      strategySelection: false,
      deckBuilder: false,
      turnCount: 1,
      timeLimit: null, // 無制限
    },
    level2: {
      strategySelection: true,
      deckBuilder: false,
      turnCount: 2,
      timeLimit: 10, // やや長め
    },
    level3: {
      strategySelection: true,
      deckBuilder: true,
      turnCount: 2,
      timeLimit: 8, // 通常
    },
  }
};
```

### スキップ機能

```
各レベルの開始時:

┌─────────────────────┐
│ レベル2: 戦略選択    │
├─────────────────────┤
│ 相手のヒントを見て   │
│ 戦略を選ぼう!       │
│                     │
│ [スタート]          │
│ [スキップ]          │ ← 経験者用
└─────────────────────┘
```

---

## UI支援システム(常時表示)

チュートリアル完了後も常に利用可能。設定でON/OFF切り替え可能。

### 1. 残りデッキ表示

**表示位置: 画面右上**

```
┌─────────────┐
│ 🎴 デッキ    │ ← クリックで開閉
└─────────────┘

展開時:
┌─────────────┐
│ 🎴 デッキ ▼  │
├─────────────┤
│ 韻A: ■■■■■│ 5枚
│ 韻B: ■■■□□│ 3枚
│ 韻C: ■■■■■│ 5枚
│ 韻D: ■■■■□│ 4枚
├─────────────┤
│ 🎯攻撃: 3   │
│ 🎯カウ: 4   │
│ 🎯自慢: 5   │
│ 🎯夢中: 2   │
└─────────────┘
```

**特徴:**
- 折りたたみ可能
- ライミング残数を視覚化(■でゲージ)
- タイプ別集計も表示

---

### 2. 戦略選択時のヒント

**表示: 各戦略ボタン内**

```
相手情報表示:
┌────────────────────────┐
│ 相手: "お前のスキルまだまだだ" │
│ 💬 雰囲気: 攻撃的          │
│ 🎵 ライミング: B系        │
└────────────────────────┘

戦略選択:
┌──────────────────────┐
│  A: 韻で攻める            │
│                          │
│  韻Bが多い → チェーン狙い! │
│  予想スコア: ★★★☆        │
└──────────────────────┘

┌──────────────────────┐
│  B: 切り返す ⭐推奨       │
│                          │
│  相手が「攻撃的」          │
│  → カウンター有効!        │
│  予想スコア: ★★★★        │
└──────────────────────┘

┌──────────────────────┐
│  C: 自分のペース          │
│                          │
│  安定型                   │
│  予想スコア: ★★☆☆        │
└──────────────────────┘
```

**推奨ロジック:**
```javascript
// 相手のタイプ推測
if (enemy.mood === "攻撃的") {
  if (player.strategyB.counterCount >= 3) {
    recommend = "B";
    hint = "相手が「攻撃的」→ カウンター有効!";
    stars = 4;
  }
}

// ライミング一致
if (enemy.rhyming === player.mostRhyming) {
  recommend = "A";
  hint = `韻${enemy.rhyming}が多い→チェーン狙い!`;
  stars = 4;
}

// デフォルト
else {
  recommend = "C";
  hint = "安定型";
  stars = 2;
}
```

---

### 3. コンボ構築時のアノテーション

**各カードに自動でヒント表示**

```
選択画面:

選択済み: 
[はいはい] [お前のスキルまだまだだ #B]

     中継ぎ2枚目を選ぶ (残り6秒)

┌──────────────────────────┐
│  それじゃおれには敵わん    │
│  #カウンター #B           │
│                          │
│  🔗 2チェーン達成!         │
│     ボーナス: x1.5倍      │
│  🎯 タイプ相性良し!       │
└──────────────────────────┘

┌──────────────────────────┐
│  大丈夫か頭               │
│  #攻撃 #B                │
│                          │
│  🔗 2チェーン達成!         │
│     ボーナス: x1.5倍      │
└──────────────────────────┘

┌──────────────────────────┐
│  言葉返すサルが           │
│  #カウンター #C           │
│                          │
│  🎯 タイプ相性良し!       │
│  ⚠️ 韻C残り1枚           │
└──────────────────────────┘
```

**アイコン凡例:**
- 🔗 ライミングチェーン可能
- 🎯 タイプ相性ボーナス
- ⚠️ この韻の残り枚数が少ない

---

### 4. チェーン予測表示

**締め選択時の特別表示**

```
選択済み: 
[教えてやる]
[綺麗ごとで耳が痛い #A]
[そんなの関係ない #A]

     締めを選ぶ (残り2秒)

┌──────────────────────────┐
│  もう言うことない #A       │
│                          │
│  🔗🔗🔗 3チェーン達成!    │
│        ボーナス: x2.0倍  │
│                          │
│  ← 締めでも韻継続!        │
└──────────────────────────┘

┌──────────────────────────┐
│  負けるはずがない #A       │
│                          │
│  🔗🔗🔗 3チェーン達成!    │
│        ボーナス: x2.0倍  │
└──────────────────────────┘

┌──────────────────────────┐
│  わかったか？             │
│                          │
│  チェーン終了             │
│  (韻なし)                │
└──────────────────────────┘
```

**ポイント:**
- 締めカードでライミング継続できることを強調
- 🔗アイコンの数でチェーン数を視覚化

---

### 5. 攻撃フェーズのガイド

**タップターゲット表示**

```
┌────────────────────────────┐
│  攻撃フェーズ              │
└────────────────────────────┘

現在再生中:
┌─────────────────┐
│  はいはい          │
│  ████████────>   │ (プログレスバー)
└─────────────────┘

次のタップ:
        ┌───┐
        │ ya │  ← 光るエフェクト
        └───┘
          ↓
      [━━━━━]  ← タップエリア
        Perfect判定範囲
```

**タップ後のフィードバック:**
```
      ★ Perfect! ★
        +100点
```

```
      ○ Good ○
        +70点
```

```
      × Bad ×
        +30点
```

---

### 6. 結果画面の詳細表示

**ターン結果**

```
┌════════════════════════════════┐
│        ターン1 結果             │
└════════════════════════════════┘

【リズム評価】 75/100点 (重み: 25%)
┌──────────────┐
│ Perfect x2   │ ████████████  50点
│ Good x2      │ ████████      28点
│ Bad x0       │               0点
│ Miss x0      │               0点
├──────────────┤
│ 合計         │               78点
│ 重み適用後   │               19.5点
└──────────────┘

【ライミング評価】 95/100点 (重み: 45%)
┌──────────────┐
│ ライミングA    │
│ 3チェーン! 🔗🔗🔗│
│ 倍率: x2.0    │
├──────────────┤
│ 基本点: 50点  │
│ チェーン: x2.0│ 100点
│ 重み適用後    │ 45点
└──────────────┘

【タイプ評価】 90/100点 (重み: 30%)
┌──────────────┐
│ 相手: #攻撃    │
│ あなた: #カウンター │
│ 相性: ○       │
│ ボーナス: x1.5│
├──────────────┤
│ 基本点: 60点  │
│ 相性: x1.5    │ 90点
│ 重み適用後    │ 27点
└──────────────┘

─────────────────────────────

総合スコア: 91.5点 → 92点

相手にダメージ: 25

敵HPバー:
[████████████░░░░░░░░] 75/100

あなたのHPバー:
[████████████████████] 100/100

─────────────────────────────

使用したコロケーション(使い切り):
[教えてやる] [綺麗ごとで耳が痛い #A]
[そんなの関係ない #A] [もう言うことない #A]

残りデッキ:
┌─────────────┐
│ 韻A: ■■□□□│ 2枚 ← 3枚使用
│ 韻B: ■■■□□│ 3枚
│ 韻C: ■■■■■│ 5枚
│ 韻D: ■■■■□│ 4枚
└─────────────┘

┌─────────────┐
│  次のターンへ │
└─────────────┘
```

**ポイント:**
- 各評価の内訳を詳細表示
- 倍率計算の過程を明示
- 残りデッキを視覚化
- 使用したカードを確認可能

---

## 設定メニュー

**アクセス: タイトル画面 or バトル画面の⚙️アイコン**

```
┌─────────────────────┐
│  ⚙️ 設定             │
├─────────────────────┤
│                     │
│ 【UI支援】           │
│ ☑ ヒント表示         │
│ ☑ 残りデッキ表示     │
│ ☑ チェーン予測       │
│ ☑ タイプ相性表示     │
│                     │
│ 【ゲーム設定】       │
│ コンボ構築時間:      │
│ ○ 8秒(標準)         │
│ ○ 12秒(ゆっくり)     │
│ ○ 16秒(じっくり)     │
│                     │
│ タップ判定:          │
│ ○ 甘め              │
│ ● 標準              │
│ ○ 厳しめ            │
│                     │
│ 【チュートリアル】   │
│ □ 再度表示する       │
│                     │
│ 【音声・音楽】       │
│ BGM音量: ━━━●━━  │ 70%
│ SE音量:  ━━━━●━  │ 80%
│                     │
│ [保存して戻る]       │
└─────────────────────┘
```

**各項目の説明:**

### UI支援
- **ヒント表示**: 戦略選択時の推奨表示、カード選択時のアイコン
- **残りデッキ表示**: 右上のデッキ情報
- **チェーン予測**: カード選択時のチェーンボーナス表示
- **タイプ相性表示**: カード選択時の🎯アイコン

### ゲーム設定
- **コンボ構築時間**: 
  - 8秒(標準): 通常プレイ
  - 12秒(ゆっくり): 初心者向け
  - 16秒(じっくり): じっくり考えたい人向け
  
- **タップ判定**:
  - 甘め: Perfect範囲 ±150ms
  - 標準: Perfect範囲 ±100ms
  - 厳しめ: Perfect範囲 ±70ms

### チュートリアル
- 再度表示する: チェックを入れると次回起動時にチュートリアル再開

---

## 実装優先度

### フェーズ1: MVP必須
1. **チュートリアルレベル1** - コンボ構築の基礎
2. **残りデッキ表示** - リソース管理の可視化
3. **戦略選択ヒント** - ⭐推奨表示
4. **コンボ構築アノテーション** - 🔗🎯⚠️アイコン

### フェーズ2: MVP後すぐ
5. **チュートリアルレベル2** - 戦略選択とライミング
6. **チェーン予測表示** - 締め選択時の強調
7. **結果画面詳細** - 内訳表示
8. **設定メニュー** - 時間調整、ヒントON/OFF

### フェーズ3: 余裕があれば
9. **チュートリアルレベル3** - デッキ構築
10. **攻撃フェーズガイド** - プログレスバー、タップエリア表示
11. **おまかせボタン** - AI自動選択(救済措置)

---

## 実装に関する技術的詳細

### チュートリアル状態管理

```javascript
// tutorialState.js
export const tutorialState = {
  // 進行状況
  currentLevel: 1, // 1-3
  completed: [], // 完了済みレベル [1, 2, 3]
  skipped: false,
  
  // 現在のステップ(レベル内の進行)
  currentStep: 0,
  
  // 各レベルの制限
  restrictions: {
    level1: {
      strategySelection: false,
      deckBuilder: false,
      turnCount: 1,
      timeLimit: null, // 無制限
      showHints: true,
      highlightRecommended: true,
    },
    level2: {
      strategySelection: true,
      deckBuilder: false,
      turnCount: 2,
      timeLimit: 10, // 10秒
      showHints: true,
      highlightRecommended: true,
    },
    level3: {
      strategySelection: true,
      deckBuilder: true,
      turnCount: 2,
      timeLimit: 8, // 通常
      showHints: true,
      highlightRecommended: false,
    },
  }
};
```

### モーダルコンポーネント

```javascript
// TutorialModal.jsx
const TutorialModal = ({ 
  show, 
  title, 
  message, 
  highlight, // どのエリアをハイライトするか
  onNext, 
  onSkip 
}) => {
  if (!show) return null;
  
  return (
    <div className="modal-overlay">
      <div className="modal-content">
        <h2>{title}</h2>
        <p>{message}</p>
        <div className="modal-buttons">
          <button onClick={onNext}>次へ</button>
          {onSkip && <button onClick={onSkip}>スキップ</button>}
        </div>
      </div>
      {highlight && <Highlight target={highlight} />}
    </div>
  );
};
```

### ハイライトコンポーネント

```javascript
// Highlight.jsx
// 特定のエリアを光らせる
const Highlight = ({ target }) => {
  return (
    <>
      <div className="overlay-dark" /> {/* 暗いオーバーレイ */}
      <div className={`highlight-area ${target}`}>
        {/* 対象エリアだけ明るく */}
      </div>
    </>
  );
};

// 使用例
<Highlight target="comboBuilder" />
// → コンボ構築エリアだけ明るく、他は暗く
```

### UI支援の状態管理

```javascript
// uiSupportState.js
export const uiSupportState = {
  // 各機能のON/OFF
  hintsEnabled: true,
  deckDisplayEnabled: true,
  chainPredictionEnabled: true,
  typeMatchingEnabled: true,
  
  // ゲーム設定
  comboTimeLimit: 8, // 8, 12, 16
  tapJudgement: 'normal', // 'easy', 'normal', 'hard'
  
  // 音量
  bgmVolume: 70,
  seVolume: 80,
};
```

### ヒント計算ロジック

```javascript
// hintCalculator.js

// 戦略選択時の推奨計算
export const calculateStrategyRecommendation = (enemy, playerDeck) => {
  const recommendations = {
    A: { score: 0, hint: '', stars: 2 },
    B: { score: 0, hint: '', stars: 2 },
    C: { score: 0, hint: '', stars: 2 },
  };
  
  // 相手のタイプに基づく推奨
  if (enemy.mood === '攻撃的') {
    const counterCount = playerDeck.strategyB.filter(
      card => card.type === '#カウンター'
    ).length;
    
    if (counterCount >= 3) {
      recommendations.B.score += 40;
      recommendations.B.hint = '相手が「攻撃的」\n→ カウンター有効!';
      recommendations.B.stars = 4;
    }
  }
  
  if (enemy.mood === '自信満々') {
    const attackCount = playerDeck.strategyB.filter(
      card => card.type === '#攻撃'
    ).length;
    
    if (attackCount >= 3) {
      recommendations.B.score += 30;
      recommendations.B.hint = '相手が「自信満々」\n→ 攻撃で返そう!';
      recommendations.B.stars = 3;
    }
  }
  
  // 相手のライミングとの一致度
  const rhymingCounts = {
    A: playerDeck.strategyA.filter(c => c.rhyming === 'A').length,
    B: playerDeck.strategyA.filter(c => c.rhyming === 'B').length,
    C: playerDeck.strategyA.filter(c => c.rhyming === 'C').length,
    D: playerDeck.strategyA.filter(c => c.rhyming === 'D').length,
  };
  
  const matchingRhyming = enemy.rhyming;
  if (rhymingCounts[matchingRhyming] >= 3) {
    recommendations.A.score += 50;
    recommendations.A.hint = `韻${matchingRhyming}が多い\n→ チェーン狙い!`;
    recommendations.A.stars = 4;
  }
  
  // 最高スコアの戦略を推奨
  const bestStrategy = Object.entries(recommendations)
    .sort((a, b) => b[1].score - a[1].score)[0];
  
  return {
    recommended: bestStrategy[0],
    details: recommendations,
  };
};

// カード選択時のアノテーション計算
export const calculateCardAnnotations = (card, context) => {
  const annotations = [];
  
  // ライミングチェーン判定
  if (context.previousCards.length > 0) {
    const lastCard = context.previousCards[context.previousCards.length - 1];
    if (lastCard.rhyming === card.rhyming && card.rhyming !== '-') {
      const chainLength = context.previousCards.filter(
        c => c.rhyming === card.rhyming
      ).length + 1;
      
      const multiplier = getChainMultiplier(chainLength);
      annotations.push({
        icon: '🔗',
        text: `${chainLength}チェーン達成!`,
        subtext: `ボーナス: x${multiplier}倍`,
        type: 'chain',
      });
    }
  }
  
  // タイプ相性判定
  if (context.enemy && context.enemy.type) {
    const typeChart = getTypeChart();
    const match = typeChart[context.enemy.type]?.[card.type];
    
    if (match && match.bonus > 1.0) {
      annotations.push({
        icon: '🎯',
        text: 'タイプ相性良し!',
        subtext: `ボーナス: x${match.bonus}倍`,
        type: 'typeMatch',
      });
    }
  }
  
  // 残り枚数警告
  const remaining = context.deckRemaining[card.rhyming];
  if (remaining <= 2 && remaining > 0) {
    annotations.push({
      icon: '⚠️',
      text: `韻${card.rhyming}残り${remaining}枚`,
      type: 'warning',
    });
  }
  
  return annotations;
};

// チェーン倍率取得
const getChainMultiplier = (chainLength) => {
  const multipliers = {
    1: 1.0,
    2: 1.5,
    3: 2.0,
    4: 3.0,
    5: 4.0,
  };
  return multipliers[Math.min(chainLength, 5)] || 4.0;
};
```

---

## デザイン・スタイリング

### カラーパレット

```css
/* チュートリアル関連 */
--tutorial-highlight: #FFD700; /* ゴールド - 推奨・ハイライト */
--tutorial-overlay: rgba(0, 0, 0, 0.7); /* 暗いオーバーレイ */
--tutorial-modal-bg: #2C2C2C; /* モーダル背景 */

/* アイコンカラー */
--icon-chain: #FF6B35; /* オレンジ - チェーン */
--icon-type: #4ECDC4; /* シアン - タイプ相性 */
--icon-warning: #FFE66D; /* イエロー - 警告 */

/* 判定カラー */
--perfect: #00FF87; /* グリーン */
--good: #FFA500; /* オレンジ */
--bad: #FF4444; /* レッド */
```

### アニメーション

```css
/* 推奨カードの光るエフェクト */
@keyframes glow {
  0%, 100% {
    box-shadow: 0 0 10px var(--tutorial-highlight);
  }
  50% {
    box-shadow: 0 0 20px var(--tutorial-highlight);
  }
}

.recommended-card {
  animation: glow 2s infinite;
  border: 2px solid var(--tutorial-highlight);
}

/* タップターゲットの脈動 */
@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.8;
  }
}

.tap-target {
  animation: pulse 1s infinite;
}

/* チェーンアイコンの出現 */
@keyframes slideIn {
  from {
    transform: translateY(-10px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.chain-icon {
  animation: slideIn 0.3s ease-out;
}
```

---

## アクセシビリティ対応

### キーボード操作

```
チュートリアルモーダル:
- Enter / Space: 次へ
- Esc: スキップ(可能な場合)

カード選択:
- Tab: 次のカード
- Shift + Tab: 前のカード
- Enter / Space: 選択

戦略選択:
- 1, 2, 3キー: 戦略A, B, C選択
- 矢印キー: 選択移動
- Enter: 決定
```

### スクリーンリーダー対応

```html
<!-- カード選択 -->
<button 
  aria-label="お前のスキルまだまだだ、カウンター、ライミングB、2チェーン達成、タイプ相性良し"
  role="button"
>
  <div>お前のスキルまだまだだ</div>
  <div aria-hidden="true">🔗 2チェーン達成!</div>
  <div aria-hidden="true">🎯 タイプ相性良し!</div>
</button>

<!-- 戦略選択 -->
<button 
  aria-label="戦略B、切り返す、推奨、相手が攻撃的なのでカウンター有効、予想スコア4つ星"
  role="button"
>
  <div>B: 切り返す ⭐推奨</div>
  <div>相手が「攻撃的」→ カウンター有効!</div>
</button>
```

---

## テストプレイ時のチェック項目

### チュートリアルの有効性
- [ ] レベル1で基本操作を理解できるか
- [ ] レベル2で戦略選択とライミングを理解できるか
- [ ] レベル3でデッキ構築を理解できるか
- [ ] スキップ機能は分かりやすいか
- [ ] 各レベルの時間は適切か

### UI支援の有用性
- [ ] 残りデッキ表示は見やすいか
- [ ] 戦略選択ヒントは役立つか
- [ ] カードアノテーションは分かりやすいか
- [ ] チェーン予測は理解しやすいか
- [ ] 結果画面の詳細は読みやすいか

### 設定メニューの使いやすさ
- [ ] 各設定項目は分かりやすいか
- [ ] ON/OFFの切り替えは即座に反映されるか
- [ ] 時間調整は適切な選択肢か
- [ ] タップ判定の違いは体感できるか

### 認知負荷の確認
- [ ] 初心者は迷わずプレイできるか
- [ ] 情報過多になっていないか
- [ ] ヒントは邪魔にならないか
- [ ] 上級者はヒントをOFFにして快適にプレイできるか

---

## よくある質問(FAQ)

### Q1: チュートリアルはスキップできる?
**A:** はい、各レベルの開始時にスキップボタンがあります。経験者はすぐにゲームを始められます。

### Q2: ヒント表示を消したい
**A:** 設定メニュー(⚙️)から各UI支援機能をON/OFFできます。

### Q3: 制限時間が短すぎる
**A:** 設定メニューから「コンボ構築時間」を12秒または16秒に変更できます。

### Q4: タップ判定が厳しい/甘い
**A:** 設定メニューから「タップ判定」を変更できます。甘め・標準・厳しめの3段階です。

### Q5: チュートリアルをもう一度見たい
**A:** 設定メニューの「チュートリアル再度表示」にチェックを入れると、次回起動時に再開します。

### Q6: 推奨戦略を無視しても大丈夫?
**A:** はい。推奨は参考です。自分の戦略を試すのもゲームの楽しみ方の一つです。

### Q7: アイコンの意味は?
**A:** 
- 🔗 ライミングチェーン可能
- 🎯 タイプ相性ボーナス
- ⚠️ この韻の残り枚数が少ない

---

## 実装チェックリスト

### チュートリアル実装
- [ ] tutorialState の実装
- [ ] TutorialModal コンポーネント
- [ ] Highlight コンポーネント
- [ ] レベル1フロー実装
- [ ] レベル2フロー実装
- [ ] レベル3フロー実装
- [ ] スキップ機能
- [ ] 進行状態の保存(localStorage)

### UI支援実装
- [ ] 残りデッキ表示コンポーネント
- [ ] 戦略選択ヒント計算ロジック
- [ ] カードアノテーション計算ロジック
- [ ] チェーン予測表示
- [ ] 結果画面詳細表示
- [ ] 攻撃フェーズガイド

### 設定メニュー実装
- [ ] 設定画面UI
- [ ] uiSupportState 管理
- [ ] 各設定の即時反映
- [ ] 設定の保存(localStorage)

### デザイン・アニメーション
- [ ] カラーパレット適用
- [ ] 推奨カードの光るエフェクト
- [ ] タップターゲットの脈動
- [ ] チェーンアイコンのアニメーション
- [ ] モーダルのフェードイン/アウト

### アクセシビリティ
- [ ] キーボード操作対応
- [ ] スクリーンリーダー対応
- [ ] aria-label 設定
- [ ] フォーカス管理

### テスト
- [ ] チュートリアル全レベルの動作確認
- [ ] UI支援機能の動作確認
- [ ] 設定メニューの動作確認
- [ ] 各種アニメーションの確認
- [ ] アクセシビリティの確認
- [ ] 複数ブラウザでの動作確認

---

## まとめ

このチュートリアル・UI支援仕様により:

✅ **初心者でも迷わずプレイ可能**
- 3段階のチュートリアルで段階的に学習
- 常時表示のヒントで認知負荷を軽減

✅ **上級者も快適にプレイ可能**
- ヒントのON/OFF切り替え
- スキップ機能
- カスタマイズ可能な設定

✅ **認知負荷の軽減**
- 残りデッキの可視化
- 推奨戦略の提示
- チェーン・タイプ相性の自動計算

✅ **アクセシビリティ対応**
- キーボード操作
- スクリーンリーダー対応

**この仕様により、ゲームの面白さを最大限引き出せます。**